<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Project Monitoring Dashboard</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
  <style>
    body { font-family: Arial, sans-serif; margin: 0; padding: 0; }
    header { background: #2c3e50; color: white; padding: 1rem; text-align: center; }
    nav { display: flex; background: #34495e; }
    nav button { flex: 1; padding: 1rem; border: none; color: white; background: #34495e; cursor: pointer; }
    nav button.active { background: #2c3e50; font-weight: bold; }
    section { display: none; padding: 1rem; }
    section.active { display: block; }
    #dashboard { display: flex; justify-content: space-around; padding: 1rem; background: #ecf0f1; }
    .card { background: white; padding: 1rem; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); width: 200px; text-align: center; }
    #map { height: 400px; margin: 1rem 0; }
    table { width: 95%; margin: 1rem auto; border-collapse: collapse; }
    th, td { border: 1px solid #ccc; padding: 0.5rem; text-align: left; }
    th { background: #34495e; color: white; }
    form { max-width: 600px; margin: auto; background: #ecf0f1; padding: 1rem; border-radius: 8px; }
    form label { display: block; margin-top: 0.5rem; }
    form input, form select, form textarea { width: 100%; padding: 0.5rem; margin-top: 0.2rem; }
    form button { margin-top: 1rem; padding: 0.7rem; background: #2c3e50; color: white; border: none; cursor: pointer; border-radius: 5px; }
  </style>
</head>
<body>

<header>
  <h1>Project Monitoring & Management Dashboard</h1>
</header>

<nav>
  <button class="active" onclick="openTab('tab-dashboard')">Dashboard</button>
  <button onclick="openTab('tab-map')">Map</button>
  <button onclick="openTab('tab-monitoring')">Monitoring</button>
</nav>

<!-- Dashboard Section -->
<section id="tab-dashboard" class="active">
  <div id="dashboard">
    <div class="card">
      <h2 id="totalSites">0</h2>
      <p>Total Sites</p>
    </div>
    <div class="card">
      <h2 id="totalArea">0</h2>
      <p>Total Area (Ha)</p>
    </div>
  </div>

  <h2 style="text-align:center;">Site Details</h2>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>County</th>
        <th>Area (Ha)</th>
        <th>Layer</th>
      </tr>
    </thead>
    <tbody id="siteTable"></tbody>
  </table>
</section>

<!-- Map Section -->
<section id="tab-map">
  <div id="map"></div>
</section>

<!-- Monitoring Section -->
<section id="tab-monitoring">
  <h2 style="text-align:center;">Enter Monitoring Data</h2>
  <form id="monitoringForm">
    <label for="site">Select Site:</label>
    <select id="site" required></select>

    <label for="date">Date:</label>
    <input type="date" id="date" required>

    <label for="survival">Survival Rate (%):</label>
    <input type="number" id="survival" min="0" max="100" required>

    <label for="notes">Notes:</label>
    <textarea id="notes" rows="3"></textarea>

    <button type="submit">Save Monitoring Data</button>
  </form>

  <h2 style="text-align:center; margin-top:2rem;">Monitoring Records</h2>
  <table>
    <thead>
      <tr>
        <th>Site</th>
        <th>Date</th>
        <th>Survival Rate (%)</th>
        <th>Notes</th>
      </tr>
    </thead>
    <tbody id="monitoringTable"></tbody>
  </table>
</section>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script>
  // --- Sample Data (use your dataset) ---
  const sites = [
    { name: "Kwa Kassim Bakari", area: 4, county: "Kwale", lat: -4.2, lon: 39.5, layer: "Initial" },
    { name: "Ngathini Planted Site", area: 5.73, county: "Kwale", lat: -4.3, lon: 39.6, layer: "Initial" },
    { name: "Takaungu Moriani", area: 14.1, county: "Kilifi", lat: -3.7, lon: 39.9, layer: "Initial" },
    { name: "Majoreni", area: 7.7, county: "Kwale", lat: -4.5, lon: 39.4, layer: "Proposed" },
    { name: "Buda", area: 1.31, county: "Kwale", lat: -4.6, lon: 39.3, layer: "Adoption" }
  ];

  const monitoringRecords = [];

  // --- Dashboard Metrics ---
  document.getElementById("totalSites").textContent = sites.length;
  document.getElementById("totalArea").textContent = sites.reduce((sum, s) => sum + s.area, 0).toFixed(2);

  // --- Populate Site Table ---
  const siteTable = document.getElementById("siteTable");
  sites.forEach(s => {
    siteTable.insertAdjacentHTML("beforeend", `<tr>
      <td>${s.name}</td>
      <td>${s.county}</td>
      <td>${s.area}</td>
      <td>${s.layer}</td>
    </tr>`);
  });

  // --- Map Setup ---
  const map = L.map('map').setView([-4.2, 39.6], 8);
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '&copy; OpenStreetMap contributors'
  }).addTo(map);

  sites.forEach(site => {
    L.circleMarker([site.lat, site.lon], {
      radius: 8,
      fillColor: site.layer === "Proposed" ? "orange" : site.layer === "Adoption" ? "green" : "blue",
      color: "#000",
      weight: 1,
      opacity: 1,
      fillOpacity: 0.7
    }).addTo(map).bindPopup(`<b>${site.name}</b><br>County: ${site.county}<br>Area: ${site.area} Ha<br>Layer: ${site.layer}`);
  });

  // --- Populate Monitoring Form Site Dropdown ---
  const siteSelect = document.getElementById("site");
  sites.forEach(s => {
    siteSelect.insertAdjacentHTML("beforeend", `<option value="${s.name}">${s.name}</option>`);
  });

  // --- Handle Monitoring Form Submission ---
  document.getElementById("monitoringForm").addEventListener("submit", function(e){
    e.preventDefault();
    const record = {
      site: document.getElementById("site").value,
      date: document.getElementById("date").value,
      survival: document.getElementById("survival").value,
      notes: document.getElementById("notes").value
    };
    monitoringRecords.push(record);
    updateMonitoringTable();
    this.reset();
  });

  function updateMonitoringTable(){
    const tbody = document.getElementById("monitoringTable");
    tbody.innerHTML = "";
    monitoringRecords.forEach(r => {
      tbody.insertAdjacentHTML("beforeend", `<tr>
        <td>${r.site}</td>
        <td>${r.date}</td>
        <td>${r.survival}</td>
        <td>${r.notes}</td>
      </tr>`);
    });
  }

  // --- Tab Switching ---
  function openTab(tabId) {
    document.querySelectorAll("section").forEach(s => s.classList.remove("active"));
    document.querySelectorAll("nav button").forEach(b => b.classList.remove("active"));
    document.getElementById(tabId).classList.add("active");
    event.target.classList.add("active");
  }
</script>
</body>
</html>
