<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ report_title }} - Donor Report</title>
    <style>
        @page {
            margin: 2cm;
            @top-center {
                content: "{{ report_title }}";
                font-size: 10pt;
                color: #666;
            }
            @bottom-right {
                content: "Page " counter(page) " of " counter(pages);
                font-size: 9pt;
            }
        }
        
        body {
            font-family: 'Arial', sans-serif;
            line-height: 1.6;
            color: #333;
        }
        
        .header {
            border-bottom: 3px solid #2563eb;
            padding-bottom: 20px;
            margin-bottom: 30px;
        }
        
        .header h1 {
            color: #1e40af;
            margin: 0;
            font-size: 28pt;
        }
        
        .header .period {
            color: #666;
            font-size: 12pt;
            margin-top: 10px;
        }
        
        .summary-box {
            background: #f0f9ff;
            border-left: 4px solid #2563eb;
            padding: 20px;
            margin: 30px 0;
            page-break-inside: avoid;
        }
        
        .summary-box h2 {
            margin-top: 0;
            color: #1e40af;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            margin: 20px 0;
        }
        
        .stat-card {
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 15px;
            text-align: center;
        }
        
        .stat-card .value {
            font-size: 32pt;
            font-weight: bold;
            color: #1e40af;
        }
        
        .stat-card .label {
            color: #666;
            font-size: 11pt;
            margin-top: 5px;
        }
        
        .indicator-section {
            margin: 40px 0;
            page-break-inside: avoid;
        }
        
        .indicator-header {
            background: #1e40af;
            color: white;
            padding: 15px;
            border-radius: 8px 8px 0 0;
        }
        
        .indicator-header h3 {
            margin: 0;
            font-size: 14pt;
        }
        
        .indicator-body {
            border: 1px solid #e5e7eb;
            border-top: none;
            padding: 20px;
            border-radius: 0 0 8px 8px;
        }
        
        .metrics-row {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin: 15px 0;
        }
        
        .metric {
            background: #f9fafb;
            padding: 12px;
            border-radius: 6px;
        }
        
        .metric .label {
            font-size: 9pt;
            color: #666;
            text-transform: uppercase;
            margin-bottom: 5px;
        }
        
        .metric .value {
            font-size: 18pt;
            font-weight: bold;
            color: #1e40af;
        }
        
        .status-badge {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 9pt;
            font-weight: bold;
            text-transform: uppercase;
        }
        
        .status-on-track {
            background: #d1fae5;
            color: #065f46;
        }
        
        .status-exceeded {
            background: #dbeafe;
            color: #1e40af;
        }
        
        .status-behind {
            background: #fed7aa;
            color: #92400e;
        }
        
        .status-critical {
            background: #fecaca;
            color: #991b1b;
        }
        
        .risk-badge {
            display: inline-block;
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 8pt;
            font-weight: bold;
        }
        
        .risk-low {
            background: #d1fae5;
            color: #065f46;
        }
        
        .risk-medium {
            background: #fef3c7;
            color: #92400e;
        }
        
        .risk-high {
            background: #fed7aa;
            color: #c2410c;
        }
        
        .risk-critical {
            background: #fecaca;
            color: #991b1b;
        }
        
        .insights-box {
            background: #fffbeb;
            border-left: 3px solid #f59e0b;
            padding: 15px;
            margin: 20px 0;
        }
        
        .insights-box h4 {
            color: #92400e;
            margin-top: 0;
        }
        
        .insights-box ul {
            margin: 10px 0;
            padding-left: 20px;
        }
        
        .insights-box li {
            margin: 5px 0;
        }
        
        .recommendations-box {
            background: #f0fdf4;
            border-left: 3px solid #10b981;
            padding: 15px;
            margin: 20px 0;
        }
        
        .recommendations-box h4 {
            color: #065f46;
            margin-top: 0;
        }
        
        .recommendation-item {
            background: white;
            padding: 12px;
            margin: 10px 0;
            border-radius: 6px;
            border: 1px solid #d1fae5;
        }
        
        .recommendation-item .priority {
            font-weight: bold;
            color: #059669;
        }
        
        .chart-placeholder {
            background: #f3f4f6;
            border: 2px dashed #d1d5db;
            height: 300px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #6b7280;
            margin: 20px 0;
            border-radius: 8px;
        }
        
        .footer {
            margin-top: 50px;
            padding-top: 20px;
            border-top: 2px solid #e5e7eb;
            font-size: 9pt;
            color: #666;
            text-align: center;
        }
        
        .page-break {
            page-break-after: always;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <div class="header">
        <h1>{{ report_title }}</h1>
        <div class="period">
            Reporting Period: {{ period_start }} to {{ period_end }}
        </div>
        <div class="period">
            Generated: {{ generation_date }} | Generated by: {{ generated_by }}
        </div>
    </div>

    <!-- Executive Summary -->
    <div class="summary-box">
        <h2>Executive Summary</h2>
        <p>
            This report presents the performance analysis for {{ total_indicators }} climate resilience indicators 
            across Ultimate, Intermediate, and Immediate outcome levels for the reporting period.
        </p>
        
        <div class="stats-grid">
            <div class="stat-card">
                <div class="value">{{ summary.total_indicators }}</div>
                <div class="label">Total Indicators</div>
            </div>
            <div class="stat-card">
                <div class="value">{{ summary.on_track }}</div>
                <div class="label">On Track</div>
            </div>
            <div class="stat-card">
                <div class="value">{{ summary.behind }}</div>
                <div class="label">Behind Target</div>
            </div>
            <div class="stat-card">
                <div class="value">{{ summary.at_risk }}</div>
                <div class="label">High Risk</div>
            </div>
        </div>
    </div>

    <!-- Key Highlights -->
    <div class="insights-box">
        <h4>Key Highlights</h4>
        <ul>
            {% for highlight in key_highlights %}
            <li>{{ highlight }}</li>
            {% endfor %}
        </ul>
    </div>

    <div class="page-break"></div>

    <!-- Indicator Performance Details -->
    <h2 style="color: #1e40af; margin-top: 40px;">Indicator Performance Analysis</h2>

    {% for indicator in indicators %}
    <div class="indicator-section">
        <div class="indicator-header">
            <h3>{{ indicator.code }}: {{ indicator.name }}</h3>
        </div>
        <div class="indicator-body">
            <!-- Performance Metrics -->
            <div class="metrics-row">
                <div class="metric">
                    <div class="label">Baseline</div>
                    <div class="value">{{ indicator.baseline }}</div>
                </div>
                <div class="metric">
                    <div class="label">Target</div>
                    <div class="value">{{ indicator.target }}</div>
                </div>
                <div class="metric">
                    <div class="label">Actual</div>
                    <div class="value">{{ indicator.actual }}</div>
                </div>
            </div>

            <!-- Status and Risk -->
            <div style="margin: 20px 0;">
                <span class="status-badge status-{{ indicator.status }}">
                    {{ indicator.status_label }}
                </span>
                <span class="risk-badge risk-{{ indicator.risk_level }}" style="margin-left: 10px;">
                    {{ indicator.risk_label }}
                </span>
                <span style="margin-left: 15px; color: #666;">
                    Variance: <strong style="color: {% if indicator.variance > 0 %}#059669{% else %}#dc2626{% endif %}">
                        {{ indicator.variance }}%
                    </strong>
                </span>
            </div>

            <!-- Variance Analysis -->
            <div style="background: #f9fafb; padding: 15px; border-radius: 6px; margin: 15px 0;">
                <h4 style="color: #374151; margin-top: 0;">Variance Analysis</h4>
                <p>{{ indicator.variance_explanation }}</p>
            </div>

            <!-- Chart Placeholder -->
            {% if indicator.has_chart %}
            <div class="chart-placeholder">
                Trend Chart: {{ indicator.code }} Performance Over Time
            </div>
            {% endif %}

            <!-- ML Insights -->
            {% if indicator.insights %}
            <div class="insights-box">
                <h4>AI-Generated Insights</h4>
                <ul>
                    {% for insight in indicator.insights %}
                    <li>{{ insight }}</li>
                    {% endfor %}
                </ul>
            </div>
            {% endif %}

            <!-- Recommendations -->
            {% if indicator.recommendations %}
            <div class="recommendations-box">
                <h4>Recommended Actions</h4>
                {% for rec in indicator.recommendations %}
                <div class="recommendation-item">
                    <div class="priority">{{ rec.priority }}: {{ rec.title }}</div>
                    <div style="margin-top: 8px;">{{ rec.description }}</div>
                    <div style="margin-top: 8px; font-size: 9pt; color: #666;">
                        <strong>Timeline:</strong> {{ rec.timeline }} | 
                        <strong>Resources:</strong> {{ rec.resources }}
                    </div>
                </div>
                {% endfor %}
            </div>
            {% endif %}

            <!-- Challenges and Lessons -->
            {% if indicator.challenges %}
            <div style="background: #fef2f2; border-left: 3px solid #dc2626; padding: 15px; margin: 15px 0;">
                <h4 style="color: #991b1b; margin-top: 0;">Challenges Faced</h4>
                <p>{{ indicator.challenges }}</p>
            </div>
            {% endif %}

            {% if indicator.lessons_learned %}
            <div style="background: #f0fdf4; border-left: 3px solid #10b981; padding: 15px; margin: 15px 0;">
                <h4 style="color: #065f46; margin-top: 0;">Lessons Learned</h4>
                <p>{{ indicator.lessons_learned }}</p>
            </div>
            {% endif %}
        </div>
    </div>
    {% endfor %}

    <div class="page-break"></div>

    <!-- Predictions and Future Outlook -->
    <h2 style="color: #1e40af; margin-top: 40px;">Future Outlook & Predictions</h2>
    
    <div class="summary-box">
        <h3>End of Year Projections</h3>
        <p>Based on ML analysis of historical trends and current performance patterns:</p>
        
        {% for prediction in predictions %}
        <div style="background: white; padding: 15px; margin: 15px 0; border-radius: 6px; border: 1px solid #e5e7eb;">
            <strong>{{ prediction.indicator_code }}</strong>: 
            Projected EOY value of <strong style="color: #1e40af;">{{ prediction.predicted_value }}</strong>
            (Confidence: {{ prediction.confidence }}%)
            <div style="margin-top: 8px; color: #666; font-size: 10pt;">
                Confidence Interval: {{ prediction.confidence_interval }}
            </div>
        </div>
        {% endfor %}
    </div>

    <!-- Risk Summary -->
    <h2 style="color: #1e40af; margin-top: 40px;">Risk Assessment Summary</h2>
    
    <div style="background: #fef2f2; border-left: 3px solid #dc2626; padding: 20px; margin: 20px 0;">
        <h3 style="color: #991b1b; margin-top: 0;">High Risk Indicators Requiring Immediate Attention</h3>
        {% if high_risk_indicators %}
        <ul>
            {% for risk in high_risk_indicators %}
            <li>
                <strong>{{ risk.code }}</strong>: {{ risk.risk_summary }}
                <div style="margin-top: 5px; color: #666; font-size: 10pt;">
                    Risk Score: {{ risk.risk_score }}/100 | Factors: {{ risk.risk_factors | join(', ') }}
                </div>
            </li>
            {% endfor %}
        </ul>
        {% else %}
        <p style="color: #059669;">âœ“ No indicators currently classified as high risk.</p>
        {% endif %}
    </div>

    <!-- Footer -->
    <div class="footer">
        <p>
            This report was automatically generated using AI-powered analysis.<br>
            For questions or clarifications, please contact the M&E team.<br>
            <strong>Confidential - For Donor Reporting Only</strong>
        </p>
    </div>
</body>
</html>
